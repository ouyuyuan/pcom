\subsection{Time Differential Operator in Spherical Coordinate}
\label{der:diff}

Substantial time difference 
\beeq \label{eq:sub-diff}
\f{d}{dt} = \overbrace{ \f{\p}{\p t} }^\text{local change} + 
\underbrace{ \mathbf{v}\cdot \nabla }_\text{advective process}
\eneq

In a spherical coordinate, $\vv$ can be expressed as
\beeq \label{eq:v}
\vv = u \vel + v \vef + w \ver
\eneq

And the gradient operator (see \citet{Xie2012_book}{P.120 3.2}, 
map $q_1\ra \gl$, $q_2\ra \gf$, and $q_3\ra r$)
\beeq \label{eq:nabla}
\gn = \vel \f{1}{H_\gl} \f{\p}{\p \gl} + 
      \vef \f{1}{H_\gf} \f{\p}{\p \gf} + 
      \ver \f{1}{H_r}   \f{\p}{\p r}
\eneq

Let $\vi, \vj, \vk$ the Cartesian coordinate unit
vector, then A vector $\vr$ can be expressed in the Cartesian coordinate
as the form
\begin{align}
\vr &= x \vi + y \vj + z \vk \nonumber \\
    &= r \cosf \cosl \vi + r \cosf \sinl \vj + r \sinf \vk
\end{align}

According to \citet{Xie2012_book}{P.110 2.2} 
(map $q_1\ra \gl$, $q_2\ra \gf$, and $q_3\ra r$)
\bese \label{eq:20}
\begin{align}
  H_\gl &= \sqrt{ 
\left( \f{\p x}{\p \gl} \right)^2 +
\left( \f{\p y}{\p \gl} \right)^2 +
\left( \f{\p z}{\p \gl} \right)^2 } \notag\\
&= \sqrt{ (-r\cosf \sinl)^2 + (r\cosf \cosl)^2 + 0^2 }\notag\\
&= r\cosf \\
  H_\gf &= \sqrt{ 
\left( \f{\p x}{\p \gf} \right)^2 +
\left( \f{\p y}{\p \gf} \right)^2 +
\left( \f{\p z}{\p \gf} \right)^2 }\notag \\
&= \sqrt{ (-r\sinf \cosl)^2 + (-r\sinf \sinl)^2 + (r\cosf)^2 } \notag \\
&= r \\
  H_r &= ... = 1
\end{align}
\ense

Combine equations \ref{eq:nabla} and \ref{eq:20},
we get the expression of gradient operator in spherical coordinate
\beeq \label{eq:nabla2}
\gn = \vel \f{1}{r\cosf} \fp{}{\gl} + \vef\f{1}{r} \fp{}{\gf} + \ver\fp{}{r}
\eneq

Combine equations \ref{eq:sub-diff}, \ref{eq:v}, and \ref{eq:nabla2}, we get
\beeq
\fd{}{t} = \fp{}{t} + \f{u}{r\cosf} \fp{}{\gl} + \f{v}{r} \fp{}{\gf} + w
\fp{}{r}
\eneq

Let $r=a+z$, where $a$ is the radius of the earth, and use the thin-layer
approximation, we get the equation \ref{eq:sub-diff2}
